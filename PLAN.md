# Plan

## rummo.lua

- inserting/deleting a full marimo cell should trigger renaming all the cells
- update cells from rummo json file after saving nb file (BufWrite autocmd)

### core

- handle coordination of other pieces
- handle config

#### config options

- image file format
  - default png; options: png, svg, pdf
- rummo files temporary or not

- some control / flag for non-automatic running
  - needs extra stuff to make this possible

### cell

- Tree sitter parser to identify cells `@app.cell`
- rename cell functions, `def _(...)` -> `def _0001(...)`
  - cell names are an underscore + 4 hex characters
  - rename all cells on notebook load, before server is started
  - ~alternatively, names could be cell UIDs that `marimo` generates~
    - there is a chicken or the egg issue using marimo generated IDs
    - definitively defining cell names in the notebook avoids this issue
    - maybe define hex names at initialization, and update names to cell UID later
  - there should be a flag that for a couple cell name options
    - rename all with hex
    - keep defined names, rename only blank names (i.e. `_`) and duplicates
- cell motion
  - jump between cells
  - move cells around (low priority)
- cell creation
  - add new blank cell
  - add new markdown cell
- rummoCell manager
  - creates rummoCells (Lua Class) holding metadata for an `@app.cell`

### window handler

- creates window for displaying cell output
- creates buffer for cell collection file
- ~Tree sitter for parsing collection file (maybe)~
  - handled by cell.lua
- handles display logic (e.g. display when cursor is in cell)
  - might format text in window as markdown
- set highlight namespace for the window (probably no highlights)

### image handler

- snacks.nvim or image.nvim (?)
- may just be part of window handler
- loads/displays image from file
  - probably same window as output
  - separate window may work too

## rummo.py

These methods are for interfacing with a running user marimo notebook. A separate
server notebook will load/serve the user notebook.

### core

- manages a temp folder `__marimo__/__rummo__`
  - should have option to make persistent, config flag and/or keymapped command
  - folder contents:
    - images files from mpl_backend
    - cell collection file (likely as json or toml, maybe just markdown )
      - `vim.json` is built in
      - `vim.mpack` msgpack could be alternative; doesn't seem to have save/load
        from file
- manages the cell collection file
  - persistent file needs some naming scheme (?)
    - kind of goes against the marimo philosophy
    - persistent file just overwrites existing (images too)
- manages rummoCell (Python class) objects

### mpl_backend

- captures images from matplotlib
- saves images to `__rummo__` directory
- file naming based on cell UID generated by marimo

# Old

## Lua Part

- Server notebook setup

  - Load notebook
  - feed config as args
  - notice notebook is ready

- HTTP client

  - query commands
  - formatting methods
  - commands for temp file saving
    - probably images
    - maybe large files/IO
    - marimo caching?

- Cell class

  - holds cell info
  - cell name
  - cell range
  - cell status (e.g. stale)
  - text output
  - images (probably file path)
  - more to be added

- Display

  - float window
  - some config options
  - text format/display
  - image format/display

- Commands / Autocommands

## Python/Marimo

- Server notebook

  - loads and starts server notebook
  - load user notebook
    - use importlib
  - accepts and parses args
    - marimo settings
      - as Lua config
      - as marimo config file path
  - some class structure ?

- HTTP/FASTapi
  - all commands methods/machinery

### Questions

- How to run user notebook?
  - use `app.run`?
  - use `app.embed`?
  - update all cells reactively auto
    - probably default option
    - on-demand option for heavy notebooks

## HTTP

- Queries
  - a few files for different types of queries
